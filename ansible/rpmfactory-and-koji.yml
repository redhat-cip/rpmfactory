---

- hosts: koji
  roles:
    - epel
    - patrik.uytterhoeven.PostgreSQL-For-RHEL6x
    - koji-db
    - koji-ca
    - koji-hub
    - koji-client
    - koji-kojira
    - koji-web
    - koji-rpmfactory
    - koji-builder

- hosts: 127.0.0.1
  connection: local
  gather_facts: no
  tasks:
    - name: Fetch Koji auto-generated client certificate
      shell: sudo -u centos scp -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no centos@koji:/srv/jenkins-koji.tgz /tmp/jenkins-koji.tgz
      tags:
        - rpmf_koji_cert

- hosts: managesf
  user: root
  gather_facts: no
  pre_tasks:
    - name: Wait for cloud-init success
      wait_for: path=/var/log/cloud-init-output.log search_regex="^SUCCESS 1node-allinone$"
  roles:
    - sf-rpmfactory
  environment:
    PATH: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/.local/bin:/root/bin"
